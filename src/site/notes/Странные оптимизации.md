---
{"dg-publish":true,"permalink":"/strannye-optimizaczii/"}
---


> "Это невозможно!" - сказала Причина.  
> "Это безрассудно!" - заметил Опыт.  
> "Это бесполезно!" - отрезала Гордость.  
> "Попробуй..." - шепнула Мечта.

Здесь я напишу про странные оптимизации, которые не делает ни один твикер. Я запустил WinDirStat и увидел, что около 40% диска C-это .exe и .dll-файлы. Если взять случайный .exe/.dll и сжать его, то получится 0.6-0.7 от исходного размера. Неплохая идея для оптимизации, начинаем копать глубже.
## Способы сжатия в 2 словах

1. Удалить из файлов лишнее
2. Применить lossless-алгоритм сжатия, общий(LZMA) или специфичный для формата(типа x265, но для исполняемых файлов, такие есть?).
Скорее всего, удалить мало что удастся, потому что разработчики, скорее всего, уже удалили все такие данные(вроде отладочных символов). Хотя можно [попытаться](https://xakep.ru/2012/10/29/own-exe-files-packer/). Вторая проблема-это подписание исходного кода. Исполняемые файлы подписаны сертификатом разработчиков, я не проверял, что происходит при нарушении подписи, но решение кажется опасным.
![Pasted image 20240107221148.png](/img/user/Pasted%20image%2020240107221148.png)
Можно снять подписи, а потом переподписать все файлы своим закрытым ключём(придётся добавить свой УЦ в систему, и беречь ключи). Это будет работать до следующего обновления файлов.

Сжатие файлов, хотя и требует расхода CPU, должно быть весьма быстрым на современных машинах. Для этого есть программы вроде mpress, но они также нарушат электронную подпись. Но сжатие можно сделать прозрачным, на уровне файловой системы(NTFS/ZFS).
![Pasted image 20240107221733.png](/img/user/Pasted%20image%2020240107221733.png)

Резюмирая, вот примерные плюсы и минусы
Плюсы:
- быстро, особенно на медленных дисках
	- на SSD тоже должен быть заметен эффект, т.к. дело не только в разбросе и фрагментации файлов, но и в количестве обращений к диску и его кэше
	- для файлов размером в кэш_диска+1 байт уменьшится время чтения файла в 2 раза
	- возможно, для маленьких файлов оптимизация даст ещё больший прирост, но я применял её только для 16+КБ файлов
- файлы занимают меньше места
- быстрее первый запуск
Минусы:
- может ухудшить производительность при слабом CPU
Я проверил это на .exe и .dll в папках Program Files/Program Files(x86), не обнаружил ни ускорения, ни замедления скорости. На свой страх и риск можно попробовать и для папки Windows.